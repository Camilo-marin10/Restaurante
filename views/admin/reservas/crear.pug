extends ../../layout/index

block contenido
    div(class="py-10")
        h2(class="text-3xl font-bold text-gray-900 mb-6") #{titulo}
        
        // Mensajes de error de Express Validator/Validaciones de Disponibilidad
        if errores
            div(class="max-w-xl mx-auto")
                each error in errores
                    p(class="bg-red-500 text-white uppercase text-xs text-center p-2 mb-1 font-bold")= error.msg

        div(class="bg-white shadow-lg py-8 px-4 rounded-lg mx-auto max-w-xl")
            form(method="POST")
                input(type="hidden" name="_csrf" value= csrfToken)

                // Selección de Cliente
                div(class="mb-4")
                    label(for="clienteId" class="block text-sm uppercase text-gray-500 mb-2 font-bold") Cliente
                    select(id="clienteId" name="clienteId" class="w-full px-3 py-2 border border-gray-300 rounded-md")
                        option(value="") -- Seleccionar Cliente --
                        each cliente in clientes
                            // Preselecciona el cliente si se regresó con errores (datos.clienteId)
                            option(value=cliente.id selected= datos.clienteId == cliente.id ? true : false) #{cliente.nombre} #{cliente.apellido} (#{cliente.telefono})
                        if clientes.length === 0
                            option(value="" disabled) No hay clientes registrados. (Cree uno en Gestión de Clientes)

                // Fecha y Hora
                div(class="grid grid-cols-1 md:grid-cols-2 gap-4")
                    div(class="mb-4")
                        label(for="fecha_reserva" class="block text-sm uppercase text-gray-500 mb-2 font-bold") Fecha
                        input(id="fecha_reserva" name="fecha_reserva" type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400" value= datos.fecha_reserva)

                    div(class="mb-4")
                        label(for="hora_reserva" class="block text-sm uppercase text-gray-500 mb-2 font-bold") Hora
                        input(id="hora_reserva" name="hora_reserva" type="time" class="w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400" value= datos.hora_reserva)
                
                // Personas y Duración
                div(class="grid grid-cols-1 md:grid-cols-2 gap-4")
                    div(class="mb-4")
                        label(for="numero_personas" class="block text-sm uppercase text-gray-500 mb-2 font-bold") No. Personas
                        input(id="numero_personas" name="numero_personas" type="number" min="1" placeholder="Ej. 4" class="w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400" value= datos.numero_personas)
                    
                    div(class="mb-4")
                        label(for="duracion_estimada" class="block text-sm uppercase text-gray-500 mb-2 font-bold") Duración Estimada
                        select(id="duracion_estimada" name="duracion_estimada" class="w-full px-3 py-2 border border-gray-300 rounded-md")
                            each duracion in duraciones
                                // El valor por defecto al crear es 1.5. Si datos existe, usa datos, si no, usa 1.5 como default.
                                - const selectedValue = datos.duracion_estimada ? datos.duracion_estimada : 1.5;
                                option(value=duracion.valor selected= selectedValue == duracion.valor ? true : false)= duracion.texto

                // Selección de Mesa
                div(class="mb-4")
                    label(for="mesaId" class="block text-sm uppercase text-gray-500 mb-2 font-bold") Mesa Asignada
                    select(id="mesaId" name="mesaId" class="w-full px-3 py-2 border border-gray-300 rounded-md")
                        option(value="") -- Seleccionar Mesa --
                        each mesa in mesas
                            option(value=mesa.id selected= datos.mesaId == mesa.id ? true : false)= mesa.nombre + ' (Capacidad: ' + mesa.capacidad + ')'
                        if mesas.length === 0
                            option(value="" disabled) No hay mesas activas.

                // Notas
                div(class="mb-4")
                    label(for="notas" class="block text-sm uppercase text-gray-500 mb-2 font-bold") Notas de la Reserva (Opcional)
                    textarea(id="notas" name="notas" placeholder="Solicitud especial, razón de la reserva, etc." class="w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400")= datos.notas

                input(type="submit" value="Crear Reserva" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 cursor-pointer rounded-md uppercase transition duration-300")