extends ../layout/index

block contenido
    div(class="py-12 px-4 sm:px-6 lg:px-8 bg-gray-50")
        h2(class="text-4xl font-extrabold text-red-800 mb-8 border-b pb-2 tracking-tight") Panel de control

        

        h3(class="text-2xl font-bold text-gray-700 mb-6") Rendimiento y análisis (90 días)

        div(class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 mb-12")
            div(class="bg-white overflow-hidden shadow-xl rounded-lg p-5")
                dt(class="text-sm font-medium text-gray-500") Reservas exitosas
                dd(class="mt-1 text-3xl font-bold text-green-600") #{completadas90}
            
            div(class="bg-white overflow-hidden shadow-xl rounded-lg p-5")
                dt(class="text-sm font-medium text-gray-500") Tasa de No-Shows
                dd(class="mt-1 text-3xl font-bold text-red-600") #{tasaNoShows}%
            
            div(class="bg-white overflow-hidden shadow-xl rounded-lg p-5")
                dt(class="text-sm font-medium text-gray-500") Total personas atendidas
                dd(class="mt-1 text-3xl font-bold text-red-700") #{capacidadAtendida90}
            
            div(class="bg-white overflow-hidden shadow-xl rounded-lg p-5")
                dt(class="text-sm font-medium text-gray-500") Reservas promedio/Día
                dd(class="mt-1 text-3xl font-bold text-gray-700") #{reservasPromedioDia}

            div(class="bg-white overflow-hidden shadow-xl rounded-lg p-5")
                dt(class="text-sm font-medium text-gray-500") Reservas canceladas
                dd(class="mt-1 text-3xl font-bold text-orange-600") #{canceladas90}


        h2(class="text-2xl font-semibold text-gray-700 mt-8 mb-4 border-t pt-4") Mesas activas

        div(class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-12")
            if mapaDeMesas.length
                each mesa in mapaDeMesas
                    // Lógica para asignar las clases de color
                    - let bgColor = 'bg-gray-100'; 
                    - let statusText = 'LIBRE';
                    - let actionLink = '/admin/reservas/crear';
                    - let textColor = 'text-gray-800'; 
                    - let accentColor = 'bg-gray-300'; 

                    if mesa.status === 'Reservada'
                        - bgColor = 'bg-red-300'; 
                        - statusText = 'RESERVADA';
                        - actionLink = mesa.reservaId ? `/admin/reservas/editar/${mesa.reservaId}` : '/admin/reservas';
                        - textColor = 'text-gray-900'; 
                        - accentColor = 'bg-red-500'; 
                    else if mesa.status === 'Ocupada'
                        - bgColor = 'bg-red-600'; 
                        - statusText = 'OCUPADA';
                        - actionLink = mesa.reservaId ? `/admin/reservas/editar/${mesa.reservaId}` : '/admin/reservas';
                        - textColor = 'text-white'; 
                        - accentColor = 'bg-red-900'; 

                   
                    div(class=`p-4 rounded-lg shadow-lg transform transition duration-300 hover:scale-[1.02] ${bgColor}`)
                        
                        div(class="flex justify-between items-center mb-2")
                            h3(class=`text-xl font-bold truncate ${textColor}`) #{mesa.nombre}
                            p(class=`text-sm font-semibold px-2 py-1 rounded-full text-white ${accentColor}`) #{mesa.zona}

                        div(class="mb-3")
                            p(class=`text-sm font-semibold ${textColor}`) Capacidad: #{mesa.capacidad} personas
                            p(class=`text-lg font-bold uppercase mt-1 ${textColor}`) Estado: #{statusText}

                        p(class=`text-xs mb-3 ${textColor === 'text-white' ? 'text-white' : 'text-gray-600'}`) #{mesa.info ? mesa.info : 'Disponible para reserva/ocupación inmediata.'}
                        
                        a(class="block w-full mt-3 px-3 py-1 text-center text-sm font-semibold rounded-md shadow-sm bg-white text-red-600 border border-red-600 hover:bg-red-50" href=actionLink)
                            = mesa.status === 'Libre' ? 'Crear Reserva' : 'Ver Detalles'

            else
                div(class="col-span-4 p-4 bg-gray-100 rounded-lg")
                    p(class="text-center text-gray-600 font-semibold") No hay mesas activas para mostrar. Revisa el módulo de Gestión de Mesas.
        

        div(class="bg-white shadow-2xl rounded-xl overflow-hidden border border-gray-100")
            div(class="px-6 py-5 sm:px-8 bg-red-50 border-b border-red-200")
                h3(class="text-xl leading-6 font-bold text-red-800") Próximas Reservas (5 Días)
                p(class="mt-1 max-w-2xl text-sm text-gray-600") Listado de reservas activas desde hoy, ordenadas por fecha y hora.
            
            div(class="border-t border-gray-200")
                if reservasDelDia.length
                    div(class="overflow-x-auto")
                        table(class="min-w-full divide-y divide-gray-200")
                            thead(class="bg-gray-100")
                                tr
                                    th(class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider") Fecha y Hora
                                    th(class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider") Cliente
                                    th(class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider") Personas
                                    th(class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider") Mesa
                                    th(class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider") Estado
                                    th(class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider") Acciones
                            
                            tbody(class="bg-white divide-y divide-gray-100")
                                each reserva in reservasDelDia
                                    tr(class="hover:bg-gray-50")
                                        td(class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900") #{reserva.hora}
                                        td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-600") #{reserva.cliente}
                                        td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-600") #{reserva.personas}
                                        td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-600") #{reserva.mesa}
                                        td(class="px-6 py-4 whitespace-nowrap")
                                            - 
                                                let estadoClase = 'bg-gray-200 text-gray-700'; 
                                                if (reserva.estado === 'Confirmada') estadoClase = 'bg-green-100 text-green-800';
                                                else if (reserva.estado === 'Pendiente') estadoClase = 'bg-amber-100 text-amber-800';
                                                else if (reserva.estado === 'En Curso') estadoClase = 'bg-red-100 text-red-800';
                                                else if (reserva.estado === 'Cancelada' || reserva.estado === 'No-Show') estadoClase = 'bg-red-200 text-red-900';
                                                else if (reserva.estado === 'Completada') estadoClase = 'bg-gray-300 text-gray-700';
                                            
                                            span(class=`${estadoClase} px-3 py-1 inline-flex text-xs leading-5 font-bold rounded-full shadow-sm`) #{reserva.estado}
                                        
                                        td(class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-4")
                                            a(class="text-red-600 hover:text-red-900 font-semibold" href=`/admin/reservas/editar/${reserva.id}`) Gestionar
                                            
                                            form(method="POST" action=`/admin/reservas/estado/${reserva.id}` class="inline-block" onsubmit="return confirm('¿Confirmar No-Show para esta reserva?');")
                                                input(type="hidden" name="_csrf" value= csrfToken)
                                                input(type="hidden" name="nuevoEstado" value="No-Show") 
                                                button(type="submit" class="text-gray-500 hover:text-red-900 font-semibold") No-Show
                else
                    div(class="p-8 text-center text-gray-500 text-lg") No hay reservas activas en los próximos 5 días.