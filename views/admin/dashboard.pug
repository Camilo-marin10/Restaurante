extends ../layout/index

block contenido
    div(class="py-12 px-4 sm:px-6 lg:px-8 bg-gray-50")
        h2(class="text-4xl font-extrabold text-red-800 mb-8 border-b pb-2 tracking-tight") Panel de Control

        h3(class="text-2xl font-bold text-gray-700 mb-6") Operaciones de Hoy

        div(class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12")
            div(class="bg-white overflow-hidden shadow-2xl rounded-xl p-6 border-l-4 border-red-600")
                dt(class="text-sm font-medium text-gray-500 uppercase tracking-wider") Total de Reservas (Hoy)
                dd(class="mt-1 text-4xl font-extrabold text-red-700") #{reservasHoy}
            
            div(class="bg-white overflow-hidden shadow-2xl rounded-xl p-6 border-l-4 border-orange-600")
                dt(class="text-sm font-medium text-gray-500 uppercase tracking-wider") Capacidad Ocupada (Personas)
                dd(class="mt-1 text-4xl font-extrabold text-orange-700") #{capacidadOcupada}
            
            div(class="bg-white overflow-hidden shadow-2xl rounded-xl p-6 border-l-4 border-red-800")
                dt(class="text-sm font-medium text-gray-500 uppercase tracking-wider") No-Shows Reportados Hoy
                dd(class="mt-1 text-4xl font-extrabold text-red-900") #{noShowsHoy}

        h3(class="text-2xl font-bold text-gray-700 mb-6") Rendimiento y Análisis (90 Días)

        div(class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 mb-12")
            div(class="bg-white overflow-hidden shadow-xl rounded-lg p-5")
                dt(class="text-sm font-medium text-gray-500") Reservas Exitosas
                dd(class="mt-1 text-3xl font-bold text-green-600") #{completadas90}
            
            div(class="bg-white overflow-hidden shadow-xl rounded-lg p-5")
                dt(class="text-sm font-medium text-gray-500") Tasa de No-Shows
                dd(class="mt-1 text-3xl font-bold text-red-600") #{tasaNoShows}%
            
            div(class="bg-white overflow-hidden shadow-xl rounded-lg p-5")
                dt(class="text-sm font-medium text-gray-500") Total Personas Atendidas
                dd(class="mt-1 text-3xl font-bold text-red-700") #{capacidadAtendida90}
            
            div(class="bg-white overflow-hidden shadow-xl rounded-lg p-5")
                dt(class="text-sm font-medium text-gray-500") Reservas Promedio/Día
                dd(class="mt-1 text-3xl font-bold text-gray-700") #{reservasPromedioDia}

            div(class="bg-white overflow-hidden shadow-xl rounded-lg p-5")
                dt(class="text-sm font-medium text-gray-500") Reservas Canceladas
                dd(class="mt-1 text-3xl font-bold text-orange-600") #{canceladas90}


        div(class="bg-white shadow-2xl rounded-xl overflow-hidden border border-gray-100")
            div(class="px-6 py-5 sm:px-8 bg-red-50 border-b border-red-200")
                h3(class="text-xl leading-6 font-bold text-red-800") Próximas Reservas (5 Días)
                p(class="mt-1 max-w-2xl text-sm text-gray-600") Listado de reservas activas desde hoy, ordenadas por fecha y hora.
            
            div(class="border-t border-gray-200")
                if reservasDelDia.length
                    div(class="overflow-x-auto")
                        table(class="min-w-full divide-y divide-gray-200")
                            thead(class="bg-gray-100")
                                tr
                                    th(class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider") Fecha y Hora
                                    th(class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider") Cliente
                                    th(class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider") Personas
                                    th(class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider") Mesa
                                    th(class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider") Estado
                                    th(class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider") Acciones
                            
                            tbody(class="bg-white divide-y divide-gray-100")
                                each reserva in reservasDelDia
                                    tr(class="hover:bg-gray-50")
                                        td(class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900") #{reserva.hora}
                                        td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-600") #{reserva.cliente}
                                        td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-600") #{reserva.personas}
                                        td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-600") #{reserva.mesa}
                                        td(class="px-6 py-4 whitespace-nowrap")
                                            - 
                                                let estadoClase = 'bg-gray-200 text-gray-700'; 
                                                if (reserva.estado === 'Confirmada') estadoClase = 'bg-green-100 text-green-800';
                                                else if (reserva.estado === 'Pendiente') estadoClase = 'bg-amber-100 text-amber-800';
                                                else if (reserva.estado === 'En Curso') estadoClase = 'bg-red-100 text-red-800';
                                                else if (reserva.estado === 'Cancelada' || reserva.estado === 'No-Show') estadoClase = 'bg-red-200 text-red-900';
                                                else if (reserva.estado === 'Completada') estadoClase = 'bg-gray-300 text-gray-700';
                                            
                                            span(class=`${estadoClase} px-3 py-1 inline-flex text-xs leading-5 font-bold rounded-full shadow-sm`) #{reserva.estado}
                                        
                                        td(class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-4")
                                            a(class="text-red-600 hover:text-red-900 font-semibold" href=`/admin/reservas/editar/${reserva.id}`) Gestionar
                                            
                                            form(method="POST" action=`/admin/reservas/estado/${reserva.id}` class="inline-block" onsubmit="return confirm('¿Confirmar No-Show para esta reserva?');")
                                                input(type="hidden" name="_csrf" value= csrfToken)
                                                input(type="hidden" name="nuevoEstado" value="No-Show") 
                                                button(type="submit" class="text-gray-500 hover:text-red-900 font-semibold") No-Show
                else
                    div(class="p-8 text-center text-gray-500 text-lg") No hay reservas activas en los próximos 5 días.